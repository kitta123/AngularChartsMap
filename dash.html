{% extends "layout.html" %}
{% block page_title %}
PolyLogyx - Dashboard
{% endblock %}

{% block content %}

<style type="text/css">
  .body-fluid {
    height: 100px !important;
  }
  .align-top-alerts{
    margin-top: -1rem;
  }
</style>

<script src="/static/js/utils.js"></script>


<!-- begin:: Content -->
<div class="kt-content kt-grid__item kt-grid__item--fluid">
  <div class="kt-portlet kt-portlet--mobile kt-portlet--responsive-mobile" style="margin-bottom: 0px;">
    <div class="kt-portlet__head kt-portlet__head--lg">
      <div class="kt-portlet__head-label">
        <!-- <span class="kt-portlet__head-icon">
                <i class="kt-font-brand flaticon2-line-chart"></i>
              </span> -->
        <h3 class="kt-portlet__head-title">
          PolyLogyx Endpoint Dashboard
        </h3>
      </div>
      <div class="kt-portlet__head-toolbar">
        <div class="kt-portlet__head-wrapper">
          <div class="kt-portlet__head-actions">
            <div class="" style="">
              <button type="button" class="btn btn-outline-secondary btn-icon-sm" data-toggle="modal" data-target="#osquery_modal" aria-haspopup="true" aria-expanded="false" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Click -> Download PolyLogyx Installer">
                <i class="la la-cloud-download"></i>
                <span>Download PolyLogyx Installer</span>
              </button>
              <div class="modal fade" id="osquery_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true" style="">
                <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h3 class="kt-portlet__head-title">
                        Download PolyLogyx Installer
                      </h3>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Close"></button>
                    </div>
                    <div class="modal-body">
                      <!--begin:: Widgets/Tasks -->
                      <div class="">
                        <p>Choose one of the packages below:</p>
                      </div>

                      <ul class="nav nav-tabs nav-tabs-line nav-tabs-bold nav-tabs-line-3x nav-tabs-line-success" role="tablist">
                        <li class="nav-item" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Click -> Windows">
                          <a class="nav-link active" data-toggle="tab" href="#windows" role="tab"><i class="fab fa-windows"></i> Windows</a>
                        </li>
                        <li class="nav-item" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Click -> Linux">
                          <a class="nav-link" data-toggle="tab" href="#linux" role="tab"><i class="fab fa-linux"></i> Linux</a>
                        </li>
                      </ul>
                      <div class="tab-content">
                        <div class="tab-pane active" id="windows" role="tabpanel">
                          <br>
                          <div class="">
                            <span style="font-size: medium;">Windows CPT Installer</span>
                            <button href="/manage/downloads/plgx_win_extn.ext.exe" type="button" class="btn btn-outline-success pull-right downloadCode" id="btn_download_exe" onclick="downloadFile(this)" value="plgx_cpt.exe" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title=" Download Windows CPT Installer">
                              <i class="fa fa-download"></i>Download
                            </button>
                          </div>

                          <div class="kt-separator kt-separator--dashed" style="height: 20px;"></div>
                          <div class="">
                            <span style="font-size: medium;">Certificate</span>
                            <button href="/manage/downloads/plgx_win_extn.ext.exe" type="button" class="btn btn-outline-success pull-right downloadCode" onclick="downloadFile(this)" value="certificate.crt" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Download Certificate for Windows">
                              <i class="fa fa-download"></i>Download</button>
                          </div>
                          <div class="kt-separator kt-separator--dashed" style="height: 20px;"></div>
                          <div class="">
                            <h3>Windows Installation:</h3>
                          </div>

                          <pre style="word-wrap: break-word; white-space: pre-wrap; margin-bottom: -1rem;" class="text-center"  data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Open Command Prompt -> write to this command ">
                                     <p style="background-color:#cccccc40;">c:\user\downloads\&gt;plgx_cpt.exe -p -i &lt; SERVER_IP(x.x.x.x) &gt; -k &lt; Full path to the certificate file &gt; -p 9000</p>
                                   </pre>
                          <h6><span style="color:#cc1313cc">Note:</span> Download CPT installer and Certificate both for installation. Use the respective command from terminal for installation.</h6>
                        </div>

                        <div class="tab-pane" id="linux" role="tabpanel">
                          <br>
                          <div class="">
                            <span style="font-size: medium;">Linux CPT Installer</span>
                            <button href="/manage/downloads/plgx_win_extn.ext.exe" type="button" class="btn btn-outline-success pull-right downloadCode" onclick="downloadFile(this)" value="linux_cpt.sh" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Download Linux CPT Installer">
                              <i class="fa fa-download"></i>Download
                            </button>
                          </div>
                          <div class="kt-separator kt-separator--dashed" style="height: 20px;"></div>
                          <div class="">
                            <span style="font-size: medium;">Certificate</span>
                            <button href="/manage/downloads/plgx_win_extn.ext.exe" type="button" class="btn btn-outline-success pull-right downloadCode" onclick="downloadFile(this)" value="certificate.crt" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Download Certificate for Linux">
                              <i class="fa fa-download"></i>Download</button>
                          </div>
                          <div class="kt-separator kt-separator--dashed" style="height: 20px;"></div>
                          <div class="">
                            <h3>Linux Based Installation:</h3>
                          </div>
                          <pre style="word-wrap: break-word; white-space: pre-wrap; margin-bottom: -1rem;" class="" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Open terminal -> write to this command">
                                     <p style="background-color:#cccccc40;">sudo bash linux_cpt.sh -ip=&lt; SERVER_IP(x.x.x.x) &gt; -port=9000</p>
                                   </pre>
                          <h6><span style="color:#cc1313cc">Note:</span> Download CPT installer for installation. Use the respective command from terminal for installation using sudo.</h6>
                        </div>
                      </div>
                      <!--end:: Widgets/Tasks -->
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
                      <!-- <button type="button" class="btn btn-success">Finish</button> -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <div class="kt-portlet__body" style="background:#acb2bb2b;">
      <!--Begin::Alerts/Section-1-->
        <div class="row">
</div>
      <div class="row">
        <div class="col-xl-3 col-md-3 col-lg-3 col-6 col-sm-6">
          <!--begin:: AlienVault OTX Alerts -->
          <a href="{{ url_for('manage.alerts') }}#div_alienvault">
          <div class="kt-portlet kt-portlet--border-bottom-success" style="border-bottom: 3px solid rgb(110, 190, 68);">
            <div class="kt-portlet__body kt-portlet__body--fluid body-fluid" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Click -> AlienVault OTX Alerts">

              <div class="kt-widget26">












                <div class="row">
                  <div class="col-md-6 col-xl-8 col-lg-8 col-sm-6 col-6">
                    <div class="kt-widget26__content align-top-alerts">
                      <span class="kt-widget26__number" id="otx_counter" style="color: #78c351;">0</span>
                      <span class="kt-widget26__desc" style="color: #464457;">AlienVault OTX Alerts</span>
                    </div>
                  </div>
                  <div class="col-md-6 col-xl-4 col-lg-4 col-sm-6 col-6">
                    <img src="/static/assets/media/AlienVaultOTX.png" height="60px" width="60px" style="opacity: 0.5" />
                  </div>
                </div>
              </div>

            </div>
          </div>
          </a>
          <!--end:: AlienVault OTX Alerts -->
        </div>
        <div class="col-xl-3 col-md-3 col-lg-3 col-6 col-sm-6">
          <!--begin:: IBMxForce Alerts -->
          <a href="{{ url_for('manage.alerts') }}#div_ibmxforce">
          <div class="kt-portlet kt-portlet--border-bottom-danger" style="border-bottom: 3px solid rgb(145, 217, 247);">
            <div class="kt-portlet__body kt-portlet__body--fluid body-fluid" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Click -> IBM X-Force Alerts">

              <div class="kt-widget26">
                <div class="row">
                  <div class="col-md-6 col-xl-8 col-lg-8 col-sm-6 col-6">
                    <div class="kt-widget26__content align-top-alerts">
                      <span class="kt-widget26__number" id="ibm_counter" style="color: #91d9f6;">0</span>
                      <span class="kt-widget26__desc" style="color: #464457;">IBM X-Force Alerts</span>
                    </div>
                  </div>
                  <div class="col-md-6 col-xl-4 col-lg-4 col-sm-6 col-6">
                    <img src="/static/assets/media/IBMxForce.png" height="60px" width="60px" style="opacity: 0.5" />
                  </div>
                </div>
              </div>

            </div>
          </div>
          </a>
          <!--end:: IBMxForce Alerts -->
        </div>
        <div class="col-xl-3 col-md-3 col-lg-3 col-6 col-sm-6">
          <!--begin:: Rule Alerts -->
          <a href="{{ url_for('manage.alerts') }}#div_rule">
          <div class="kt-portlet kt-portlet--border-bottom-brand" style="border-bottom: 3px solid rgba(229, 87, 86, 0.81);">
            <div class="kt-portlet__body kt-portlet__body--fluid body-fluid" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Click -> Rule Alerts">

              <div class="kt-widget26">
                <div class="row">
                  <div class="col-md-6 col-xl-8 col-lg-8 col-sm-6 col-6">
                    <div class="kt-widget26__content align-top-alerts">
                      <span class="kt-widget26__number" id="rule_counter" style="color: #e87373;">0</span>
                      <span class="kt-widget26__desc" style="color: #464457;">Rule Alerts</span>
                    </div>
                  </div>
                  <div class="col-md-6 col-xl-4 col-lg-4 col-sm-6 col-6">
                    <i class="fas fa-4x fa-exclamation-triangle" style="color: #e23f3ca6;"></i>
                  </div>
                </div>
              </div>

            </div>
          </div>
          </a>
          <!--end:: Rule Alerts -->
        </div>
        <div class="col-xl-3 col-md-3 col-lg-3 col-6 col-sm-6">
          <!--begin:: VirusTotal Alerts -->
          <a href="{{ url_for('manage.alerts') }}#div_virustotal">
          <div class="kt-portlet kt-portlet--border-bottom-warning" style="border-bottom: 3px solid rgb(60, 95, 246);">
            <div class="kt-portlet__body kt-portlet__body--fluid body-fluid" data-skin="dark" data-toggle="kt-tooltip" data-placement="top" title="Click -> VirusTotal Alerts">

              <div class="kt-widget26">
                <div class="row">
                  <div class="col-md-6 col-xl-8 col-lg-8 col-sm-6 col-6">
                    <div class="kt-widget26__content align-top-alerts">
                      <span class="kt-widget26__number" id="vt_counter" style="color: #3c5ff6;">0</span>
                      <span class="kt-widget26__desc" style="color: #464457;">VirusTotal Alerts</span>
                    </div>
                  </div>
                  <div class="col-md-6 col-xl-4 col-lg-4 col-sm-6 col-6">
                    <img src="/static/assets/media/VirusTotal.png" height="60px" width="60px" style="opacity: 0.5" />
                  </div>
                </div>
              </div>

            </div>
          </div>
          </a>
          <!--end:: VirusTotal Alerts -->
        </div>

      </div>
      <!--End::Alerts/Section-1-->

      <!--Begin::Pie Charts/Section-2-->
      <div class="row">
        <div class="col-xl-4 col-md-4 col-lg-4 col-12 col-sm-12">

          <!--begin::Portlet-->
          <div class="kt-portlet">
            <div class="kt-portlet__head">
              <div class="kt-portlet__head-label">
                <span class="kt-portlet__head-icon kt-hidden">
                  <i class="la la-gear"></i>
                </span>
                <h3 class="kt-portlet__head-title">
                  Platform Distribution
                </h3>
              </div>
            </div>
            <div class="kt-portlet__body">
              <div id="" style=""></div>
              <!-- <canvas id="pie-chart-platform-count"></canvas> -->
              <div id="pie-chart-platform-count" style="width: 250px; height: 120px;"></div>
            </div>
          </div>

          <!--end::Portlet-->
        </div>
        <div class="col-xl-4 col-md-4 col-lg-4 col-12 col-sm-12">

          <!--begin::Portlet-->
          <div class="kt-portlet">
            <div class="kt-portlet__head">
              <div class="kt-portlet__head-label">
                <span class="kt-portlet__head-icon kt-hidden">
                  <i class="la la-gear"></i>
                </span>
                <h3 class="kt-portlet__head-title">
                  Event Distribution
                </h3>
              </div>
            </div>
            <div class="kt-portlet__body">
              <div id="" style=""></div>
              <!-- <canvas id="pie-chart-query-count"></canvas> -->
              <div id="pie-chart-query-count" style="width: 250px; height: 120px;"></div>
            </div>
          </div>

          <!--end::Portlet-->
        </div>
        <div class="col-xl-4 col-md-4 col-lg-4 col-12 col-sm-12">

          <!--begin::Portlet-->
          <div class="kt-portlet">
            <div class="kt-portlet__head">
              <div class="kt-portlet__head-label">
                <span class="kt-portlet__head-icon kt-hidden">
                  <i class="la la-gear"></i>
                </span>
                <h3 class="kt-portlet__head-title">
                  Endpoint Status
                </h3>
              </div>
            </div>
            <div class="kt-portlet__body">
              <div id="" style=""></div>
              <!-- <canvas id="pie-chart-online-offline"></canvas> -->
              <div id="pie-chart-online-offline" style="width: 250px; height: 120px;"></div>
            </div>
          </div>

          <!--end::Portlet-->
        </div>
      </div>
      <!--End::Pie Charts/Section-2-->
      <!--Begin::Bar Charts/Section-3-->
      <div class="row">
        <div class="col-xl-4 col-md-4 col-lg-4 col-12 col-sm-12">
          <!--begin::Portlet-->
          <div class="kt-portlet">
            <div class="kt-portlet__head">
              <div class="kt-portlet__head-label">
                <span class="kt-portlet__head-icon kt-hidden">
                  <i class="la la-gear"></i>
                </span>
                <h3 class="kt-portlet__head-title">
                  Nodes generating most Alerts
                </h3>
              </div>
            </div>
            <div class="kt-portlet__body">
              <!-- <canvas id="bar-chart-node"></canvas> -->
              <!-- <div id="top_x_div" style="width: 275px; height: 150px;"></div> -->
              <div id="chartnode" style="width: 275px; height: 150px;"></div>
            </div>
          </div>
          <!--end::Portlet-->
        </div>
        <div class="col-xl-4 col-md-4 col-lg-4 col-12 col-sm-12">
          <!--begin::Portlet-->
          <div class="kt-portlet">
            <div class="kt-portlet__head">
              <div class="kt-portlet__head-label">
                <span class="kt-portlet__head-icon kt-hidden">
                  <i class="la la-gear"></i>
                </span>
                <h3 class="kt-portlet__head-title">
                  Categories generating most Alerts
                </h3>
              </div>
            </div>
            <div class="kt-portlet__body">
              <!-- <canvas id="bar-chart-query"></canvas> -->
              <!-- <div id="top_x_div2" style="width: 275px; height: 150px;"></div> -->
              <div id="chartquery" style="width: 275px; height: 150px;"></div>
            </div>
          </div>

          <!--end::Portlet-->
        </div>
        <div class="col-xl-4 col-md-4 col-lg-4 col-12 col-sm-12">
          <!--begin::Portlet-->
          <div class="kt-portlet">
            <div class="kt-portlet__head">
              <div class="kt-portlet__head-label">
                <span class="kt-portlet__head-icon kt-hidden">
                  <i class="la la-gear"></i>
                </span>
                <h3 class="kt-portlet__head-title">
                  Rules generating most Alerts
                </h3>
              </div>
            </div>
            <div class="kt-portlet__body">
              <!-- <canvas id="bar-chart-alert"></canvas> -->
              <div id="chartalert" style="width: 275px; height: 150px;"></div>
            </div>
          </div>
          <!--end::Portlet-->
        </div>
      </div>
      <!--End::Bar Charts/Section-3-->
      <!--Begin::Section-3-->
      <div id="graph" class="row">
      </div>
      <!--End::Section-3-->
    </div>
  </div>
</div>
<!-- end:: Content -->

<script>
  function downloadFile(elem) {

    window.open(
      '/manage/downloads/' + elem.value,
      '_blank' // <- This is what makes it open in a new window.
    );
  }

  function showAPIKey() {
    document.getElementById('api-key').style.display = 'block';
    document.getElementById('btn_view_api_key').style.display = 'none';


  }
</script>
<script src="/static/assets/js/chartjs.min.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>


<script type="text/javascript">
  var chartData = '{{ chart_data }}';

  chartData = chartData.replace(/\&#34;/g, '"');

  chartData = JSON.parse(chartData);
  var alertExists = chartData['alertExists'];

  $("#rule_counter").html(chartData['rule']);
  $("#vt_counter").html(chartData['virustotal']);
  $("#otx_counter").html(chartData['alienvault']);
  $("#ibm_counter").html(chartData['ibmxforce']);
  var rules = chartData['rules'];
  var queries = chartData['queries'];
  var nodes = chartData['nodes'];
  var nodes_online_offline = chartData['online_offline'];
  var query_count = chartData['query_count'];
  var platform_count = chartData['platform_count'];

  var chrome_ie_extensions = 'dummy';


  createPieGraph1('pie-chart-platform-count', 'Platform Distribution', platform_count['name_array'], platform_count['count_array'], [], chrome_ie_extensions, true);
  createPieGraph3('pie-chart-online-offline', 'Online Offline', nodes_online_offline['name_array'], nodes_online_offline['count_array'], [], chrome_ie_extensions, true);
  createPieGraph2('pie-chart-query-count', 'Top Queries', query_count['name_array'], query_count['count_array'], [], chrome_ie_extensions, true);
  // createBarGraph1('top_x_div', 'Nodes generating most Alerts', nodes['node_name'], nodes['node_alert'], [], chrome_ie_extensions, true);

  // Begin Google bar charts

  var nodeNames = [];
  var alertCountByNode = [];
  for (i = 0; i < nodes.length; i++) {
    nodeNames[i] = nodes[i][1];
    alertCountByNode[i] = nodes[i][2];
  }

    google.load('visualization', '1', {packages: ['corechart']});
    google.setOnLoadCallback(drawMaterial1);

    function drawMaterial1() {

          var datab1 = [['Name','Alert']]
           for (i=0;i<nodeNames.length;i++){
             datab1.push([nodeNames[i],alertCountByNode[i]])
           }
            var data = google.visualization.arrayToDataTable(datab1);

          var options = {
          legend:{position:'none'}

          };

          var chart = new google.visualization.ColumnChart(document.getElementById('chartnode'));
          chart.draw(data, options);
        }

    // Google barcharts2

    var queryNames = [];
    var alertCountByQueryName = [];
    for (i = 0; i < queries.length; i++) {
      queryNames[i] = queries[i][0];
      alertCountByQueryName[i] = queries[i][1];
    }
    google.load('visualization', '1', {packages: ['corechart']});
    google.setOnLoadCallback(drawMaterial2);

    function drawMaterial2() {

          var datab2 = [['Names','Alerts']]
           for (i=0;i<queryNames.length;i++){
             datab2.push([queryNames[i],alertCountByQueryName[i]])
           }
            var data = google.visualization.arrayToDataTable(datab2);

          var options = {
          legend:{position:'none'}

          };

          var chart = new google.visualization.ColumnChart(document.getElementById('chartquery'));
          chart.draw(data, options);
        }

    // Google barcharts3

    var alertNames = [];
    var alertCountByAlertName = [];
    for (i = 0; i < rules.length; i++) {
      alertNames[i] = rules[i][1];
      alertCountByAlertName[i] = rules[i][2];
    }

    google.load('visualization', '1', {packages: ['corechart']});
    google.setOnLoadCallback(drawMaterial3);

    function drawMaterial3() {

          var datab3 = [['Names','Alerts']]
           for (i=0;i<alertNames.length;i++){
             datab3.push([alertNames[i],alertCountByAlertName[i]])
           }
            var data = google.visualization.arrayToDataTable(datab3);

          var options = {
          legend:{position:'none'}

          };

          var chart = new google.visualization.ColumnChart(document.getElementById('chartalert'));
          chart.draw(data, options);
        }

         // End Google Bar Charts

  if (alertExists) {
    document.getElementById('graph').style.display = 'block';

    var nodeNames = [];
    var alertCountByNode = [];
    for (i = 0; i < nodes.length; i++) {
      nodeNames[i] = nodes[i][1];
      alertCountByNode[i] = nodes[i][2];
    }

    var alertNames = [];
    var alertCountByAlertName = [];
    for (i = 0; i < rules.length; i++) {
      alertNames[i] = rules[i][1];
      alertCountByAlertName[i] = rules[i][2];
    }

    var queryNames = [];
    var alertCountByQueryName = [];
    for (i = 0; i < queries.length; i++) {
      queryNames[i] = queries[i][0];
      alertCountByQueryName[i] = queries[i][1];
    }


    new Chart(document.getElementById("bar-chart-node"), {
      type: 'bar',

      data: {
        labels: nodeNames,
        datasets: [{
          label: "Alerts",
          // backgroundColor: ["#3e95cd", "#8e5ea2", "#3cba9f", "#e8c3b9","#c45850"],
          backgroundColor: [" #ffc300 ", " #E6F69D ", " #AADEA7 ", " #64C2A6 ", " #2D87BB "],
          data: alertCountByNode
        }]
      },
      options: {
        scales: {
          yAxes: [{
              categoryPercentage: 0.2,
              ticks: {
                beginAtZero: true,
                callback: function(value, index, values) {
                  if (Math.floor(value) === value) {
                    return value;
                  }
                }
              },
              scaleLabel: {
                display: true,
                labelString: 'Alert Count'
              }
            }

          ],
          xAxes: [{
            // Change here
            barPercentage: 1.0,
            display: false,

            categoryPercentage: 0.2,
            afterSetDimensions: function(axes) {

            },
            scaleLabel: {
              display: true,
              labelString: 'Nodes'
            }

          }]
        },
        legend: {
          display: false
        },
        title: {
          display: false,
          text: 'Node alerts'
        }
      }
    });

    new Chart(document.getElementById("bar-chart-query"), {
      type: 'bar',

      data: {
        labels: queryNames,
        datasets: [{
          label: "Queries",
          backgroundColor: [" #ffc300 ", " #E6F69D ", " #AADEA7 ", " #64C2A6 ", " #2D87BB "],

          data: alertCountByQueryName
        }]
      },
      options: {
        scales: {
          yAxes: [{
            categoryPercentage: 0.2,
            ticks: {
              beginAtZero: true,
              callback: function(value, index, values) {
                if (Math.floor(value) === value) {
                  return value;
                }
              }

            },
            scaleLabel: {
              display: true,
              labelString: 'Alert Count'
            }
          }],
          xAxes: [{
            // Change here
            barPercentage: 1.0,
            categoryPercentage: 0.2,
            display: false,
            afterSetDimensions: function(axes) {

            },
            scaleLabel: {
              display: true,
              labelString: 'Query'
            }

          }]
        },
        legend: {
          display: false
        },
        title: {
          display: false,
          text: 'Query alerts'
        }
      }
    });

    new Chart(document.getElementById("bar-chart-alert"), {
      type: 'bar',

      data: {
        labels: alertNames,
        datasets: [{
          label: "Rules",
          backgroundColor: [" #ffc300 ", " #E6F69D ", " #AADEA7 ", " #64C2A6 ", " #2D87BB "],

          data: alertCountByAlertName
        }]
      },
      options: {
        scales: {
          yAxes: [{
            categoryPercentage: 0.2,
            ticks: {
              beginAtZero: true,
              callback: function(value, index, values) {
                if (Math.floor(value) === value) {
                  return value;
                }
              }

            },
            scaleLabel: {
              display: true,
              labelString: 'Alert Count'
            }
          }],
          xAxes: [{
            // Change here
            barPercentage: 1.0,
            display: false,

            categoryPercentage: 0.2,
            afterSetDimensions: function(axes) {

            },
            scaleLabel: {
              display: true,
              labelString: 'Rule'
            }

          }]
        },
        legend: {
          display: false
        },
        title: {
          display: false,
          text: 'Rule alerts'
        }
      }
    });
  }

  function createPieGraph(graph_id, graph_name, name_array, count_array, column_array, query_name, is_recon) {
    var chart = new Chart(document.getElementById(graph_id), {
      type: 'pie',
      data: {
        labels: name_array,
        datasets: [{
          // backgroundColor: [ " 1.green color  ", " 2.red color  ", " 3.yellow color ", " 4.blue color ", " 5.grey color "],
          // backgroundColor: [" #ffc300 ", " #E6F69D ", " #AADEA7 ", " #64C2A6 ", " #2D87BB "],
          // backgroundColor: [ " #5b942d  ", " #ed4336 ", " #40aff8 ", " #f6b343 ", " #091d3a "],
          // backgroundColor: [ " #518c24  ", " #EF5350  ", " #F3D060 ", " #00539B", " #25282A "],
          backgroundColor: [ " #518c24  ", " #dd4814  ", " #ff9900 ", " #007cc0", " #072C61 "],


          data: count_array
        }]
      },
      options: {

        legend: {
          display: true,
          position: 'right',
          labels: {
            fontColor: "#2B0B3F",
          }
        },
        onClick: function(evt, item) {

        },


        title: {
          display: false,
          text: graph_name
        }
      }

    });

  }

  $(document).ready(function() {
    $('#right-panel').css('background-color', '#fafafa')
  });

// Begin Google Piecharts
var name_array_t, count_array_t, graph_id_t;

function createPieGraph1(graph_id, graph_name, name_array, count_array, column_array, query_name, is_recon) {
  // google charts
  name_array_t = name_array;
  count_array_t = count_array;
  graph_id_t =  graph_id;
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);
}

function drawChart() {


var datak = [['name_array', 'count_array']]
 for (i=0;i<name_array_t.length;i++){
   datak.push([name_array_t[i],count_array_t[i]])
 }

  var data = google.visualization.arrayToDataTable(datak);


  var options = {
    legend: { position: 'right' },
    chartArea: {width: '70%',height: '500%'}

  };

  var chart = new google.visualization.PieChart(document.getElementById(graph_id_t));

  chart.draw(data, options);
}

var query_name_t, query_count_t, graph_id_t2;
function createPieGraph2(graph_id, graph_name,a, query_count,column_array, query_name, is_recon) {
  // google charts
  query_name_t = query_count;
  query_count_t = a;
  graph_id_t2 =  graph_id;
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart1);
}

function drawChart1() {


var datak1 = [['query_name', 'query_count']]
 for (i=0;i<query_name_t.length;i++){
   datak1.push([query_count_t[i],query_name_t[i]])
 }

  var data = google.visualization.arrayToDataTable(datak1);


  var options = {
    legend: { position: 'right' },
    chartArea: {width: '70%',height: '500%'}

  };

  var chart = new google.visualization.PieChart(document.getElementById(graph_id_t2));

  chart.draw(data, options);
}

var count_t, name_t, graph_id_t3;

function createPieGraph3(graph_id, graph_name,name,count,column_array, query_name, is_recon) {
  // google charts
  count_t = count;
  name_t = name;
  graph_id_t3 =  graph_id;
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart2);
}

function drawChart2() {


var datak2 = [['query_name', 'query_count']]
 for (i=0;i<name_t.length;i++){
   datak2.push([name_t[i],count_t[i]])
 }

  var data = google.visualization.arrayToDataTable(datak2);


  var options = {
    legend: { position: 'right' },
    chartArea: {width: '70%',height: '500%'}

  };

  var chart = new google.visualization.PieChart(document.getElementById(graph_id_t3));

  chart.draw(data, options);
}
// End Google Pie Charts


</script>



{% endblock %}
